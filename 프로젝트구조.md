# 초등학생 학습 챗봇 - 최종 프로젝트 구조

## 📁 전체 디렉토리 구조

```
elementary-chatbot/
├── backend/
│   ├── server.py                    # Flask 서버 (RAG 통합)
│   ├── rag_manager.py               # RAG 시스템 관리
│   ├── requirements.txt             # Python 패키지
│   ├── uploads/                     # 업로드 파일 저장소
│   ├── chroma_db/                   # 벡터 DB 저장소
│   └── venv/                        # Python 가상환경
│
└── frontend/
    ├── src/
    │   ├── app/
    │   │   ├── layout.tsx           # Next.js 레이아웃
    │   │   ├── page.tsx             # 메인 페이지 (RxJS)
    │   │   └── globals.css          # 전역 스타일
    │   ├── components/
    │   │   ├── Header.tsx           # 헤더 컴포넌트
    │   │   ├── ChatMessage.tsx      # 메시지 컴포넌트
    │   │   ├── ChatInput.tsx        # 입력 컴포넌트
    │   │   ├── QuickButtons.tsx     # 빠른 질문 버튼
    │   │   ├── TypingIndicator.tsx  # 타이핑 인디케이터
    │   │   ├── DocumentUpload.tsx   # 파일 업로드 (RxJS)
    │   │   └── DocumentStats.tsx    # 문서 통계
    │   ├── services/
    │   │   └── api.service.ts       # RxJS API 서비스
    │   ├── store/
    │   │   └── chatStore.ts         # Jotai + RxJS 상태
    │   ├── hooks/
    │   │   └── useChatController.ts # RxJS 통합 Hook
    │   └── types/
    │       └── chat.ts              # TypeScript 타입 정의
    ├── public/
    ├── package.json
    ├── tsconfig.json
    ├── next.config.ts
    ├── tailwind.config.ts
    └── .env.local
```

## 🎯 기술 스택

### 백엔드

-   **Flask** 3.0.0 - Python 웹 프레임워크
-   **Ollama** - 로컬 LLM 실행
-   **ChromaDB** - 벡터 데이터베이스
-   **Sentence Transformers** - 한국어 임베딩
-   **LangChain** - RAG 파이프라인

### 프론트엔드

-   **Next.js** 15.5.7 (보안 패치)
-   **React** 19.0.0
-   **TypeScript** 5.6.3
-   **Jotai** 2.10.3 - 상태 관리
-   **RxJS** 7.8.1 - 반응형 프로그래밍
-   **Framer Motion** - 애니메이션
-   **Tailwind CSS** - 스타일링

## 📋 주요 기능

### ✅ 구현 완료

1. **대화 이력 유지** - 컨텍스트 기반 연속 대화
2. **RAG 시스템** - 교과서/학습 자료 기반 답변
3. **파일 업로드** - PDF, DOCX, TXT 지원
4. **RxJS 통합** - Observable 기반 API 통신
5. **초등학생 친화적 UI** - 밝고 귀여운 디자인
6. **문서 통계** - 업로드된 자료 현황 확인
7. **에러 처리** - 자동 재시도 및 에러 핸들링
8. **반응형 디자인** - 모바일/태블릿/데스크톱 대응

## 🚀 빠른 시작 가이드

### 1단계: 환경 설정

```bash
# Ollama 설치 (macOS)
brew install ollama

# 모델 다운로드
ollama pull llama3.2:3b
```

### 2단계: 백엔드 설정

```bash
# 프로젝트 생성
mkdir elementary-chatbot
cd elementary-chatbot
mkdir backend frontend

# Python 가상환경
cd backend
python3 -m venv venv
source venv/bin/activate

# 패키지 설치
pip install flask==3.0.0 flask-cors==4.0.0 ollama==0.1.6 \
    chromadb==0.4.22 sentence-transformers==2.3.1 \
    pypdf==4.0.1 python-docx==1.1.0 \
    langchain==0.1.4 langchain-community==0.0.16
```

### 3단계: 프론트엔드 설정

```bash
cd ../frontend

# Next.js 프로젝트 생성
npx create-next-app@15.5.7 . --typescript --tailwind --app

# 패키지 설치
npm install jotai@2.10.3 rxjs@7.8.1 \
    framer-motion@11.11.17 \
    lucide-react@0.460.0 \
    react-textarea-autosize@8.5.4
```

### 4단계: 환경 변수 설정

```bash
# frontend/.env.local
echo "NEXT_PUBLIC_API_URL=http://localhost:5000" > .env.local
```

## 🎮 실행 방법

### 터미널 1: Ollama 서버

```bash
ollama serve
```

### 터미널 2: 백엔드 서버

```bash
cd backend
source venv/bin/activate
python server.py
```

### 터미널 3: 프론트엔드 서버

```bash
cd frontend
npm run dev
```

### 접속

-   **프론트엔드**: http://localhost:3000
-   **백엔드 API**: http://localhost:5000

## 📝 파일별 설명

### 백엔드 핵심 파일

| 파일               | 설명            | 주요 기능                       |
| ------------------ | --------------- | ------------------------------- |
| `server.py`        | Flask 메인 서버 | 채팅 API, 파일 업로드, RAG 통합 |
| `rag_manager.py`   | RAG 시스템      | 문서 임베딩, 벡터 검색          |
| `requirements.txt` | 패키지 목록     | 의존성 관리                     |

### 프론트엔드 핵심 파일

| 파일                   | 설명            | 주요 기능                   |
| ---------------------- | --------------- | --------------------------- |
| `api.service.ts`       | RxJS API 서비스 | Observable 기반 통신        |
| `chatStore.ts`         | 상태 관리       | Jotai Atoms + RxJS Subjects |
| `useChatController.ts` | 채팅 컨트롤러   | 스트림 구독 및 관리         |
| `page.tsx`             | 메인 페이지     | UI 렌더링                   |
| `DocumentUpload.tsx`   | 파일 업로드     | RAG 자료 추가               |

## 🔄 데이터 흐름

```
1. 사용자 입력 (UI)
   ↓
2. chatRequestSubject.next() (RxJS Subject)
   ↓
3. useChatController Hook (구독)
   ↓
4. ApiService.sendMessage() (Observable)
   ↓
5. Flask API (/chat)
   ↓
6. RAG Manager (문서 검색)
   ↓
7. Ollama LLM (답변 생성)
   ↓
8. Observable 스트림 처리
   ↓
9. Jotai Atom 업데이트
   ↓
10. React 리렌더링
```

## 💡 사용 예시

### 1. 기본 대화

```
학생: 안녕!
AI: 안녕! 반가워! 오늘은 무엇을 도와줄까? 😊
```

### 2. 학습 질문

```
학생: 분수가 뭐야?
AI: [교과서 참조] 분수는 전체를 똑같이 나눈 것 중...
```

### 3. 파일 기반 질문

```
1. 수학 교과서 PDF 업로드
2. 학생: "방정식 풀이 방법 알려줘"
3. AI: [교과서 45페이지 참조] 방정식을 풀 때는...
```

## 🎨 UI 특징

### 디자인 요소

-   🌈 그라디언트 컬러 (보라-핑크-블루)
-   😊 귀여운 이모지 아바타
-   ✨ 부드러운 애니메이션
-   📱 반응형 레이아웃
-   🎮 인터랙티브 버튼

### 접근성

-   키보드 네비게이션 지원
-   포커스 인디케이터
-   적절한 색상 대비
-   시맨틱 HTML

## 🔒 보안

-   ✅ Next.js 15.5.7 (CVE-2025-66478 패치)
-   ✅ CORS 설정
-   ✅ 파일 확장자 검증
-   ✅ 입력 sanitization
-   ✅ 환경 변수 관리

## 📊 성능 최적화

-   ✅ RxJS shareReplay (캐싱)
-   ✅ switchMap (중복 요청 방지)
-   ✅ 컴포넌트 lazy loading
-   ✅ 이미지 최적화
-   ✅ 번들 크기 최소화

## 🐛 문제 해결

### 서버 연결 실패

```bash
# 백엔드 서버 상태 확인
curl http://localhost:5000/health

# Ollama 서버 확인
ollama list
```

### 패키지 설치 오류

```bash
# Node 모듈 재설치
rm -rf node_modules package-lock.json
npm install

# Python 패키지 재설치
pip install --upgrade pip
pip install -r requirements.txt
```

### 포트 충돌

```bash
# 다른 포트로 실행
npm run dev -- -p 3001

# 또는
python server.py  # server.py에서 포트 변경
```

## 📈 확장 가능성

### 단기 개선

-   [ ] 음성 입력/출력
-   [ ] 이미지 OCR
-   [ ] 퀴즈 생성 기능
-   [ ] 학습 진도 추적

### 중기 개선

-   [ ] 사용자 인증
-   [ ] 대화 저장/불러오기
-   [ ] 다중 모델 지원
-   [ ] 실시간 협업

### 장기 개선

-   [ ] 모바일 앱 (React Native)
-   [ ] 오프라인 모드
-   [ ] 부모님 대시보드
-   [ ] 학습 분석 리포트

## 📚 참고 자료

-   [Next.js 문서](https://nextjs.org/docs)
-   [RxJS 공식 문서](https://rxjs.dev)
-   [Jotai 문서](https://jotai.org)
-   [Ollama 문서](https://ollama.ai)
-   [ChromaDB 문서](https://docs.trychroma.com)

## 🙏 Credits

-   **Ollama** - 로컬 LLM 실행
-   **ChromaDB** - 벡터 데이터베이스
-   **Anthropic Claude** - 프로젝트 설계 지원
